/*
 * Timer.h
 *
 *  Created on: Mar 3, 2024
 *      Author: danh21
 */

#ifndef TIMER_H_
#define TIMER_H_



#define f_PCLK	16000000
#define T_timer	0.001		// ms
#define ARR		65535		// Auto-reload value



/*
 * Initialize Timer 1
 * */
void Timer1_init()
{
	uint32_t F_timer, PSC;
	F_timer = 1 / T_timer;
	PSC = f_PCLK / F_timer - 1;

	RCC->APB2ENR |= RCC_APB2ENR_TIM1EN; 		// TIM1 clock enable

	TIM1->PSC |= PSC;
	// F_timer = F_system / (PSC + 1) = 16,000,000 / 16,000 = 1KHz
	// => T_timer = 1ms

	TIM1->ARR = ARR;

	TIM1->CR1 |= TIM_CR1_CEN;					// Counter enable
	TIM1->CR1 &= ~(1<<4);						// Counter used as up counter
}



/*
 * delay by ms
 * */
void delay_ms(int ms)
{
	TIM1->CNT = 0;
	while (TIM1->CNT < ms);
}



#endif /* TIMER_H_ */
